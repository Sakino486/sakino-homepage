<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sakino's Gallery</title>
  <style>
    :root {
      --primary-color: #74ebd5;
      --dark-bg: #232526;
      --light-text: #fff;
      --dark-text: #333;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: var(--dark-text);
      transition: all 0.3s ease;
    }
    
    body.dark {
      background-color: var(--dark-bg);
      color: var(--light-text);
    }
    
    header {
      background: linear-gradient(270deg, #74ebd5, #9face6);
      color: white;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .gallery-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      aspect-ratio: 1;
    }
    
    .gallery-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.5s;
    }
    
    .gallery-item:hover img {
      transform: scale(1.05);
    }
    
    .admin-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 100;
    }
    
    .admin-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: all 0.3s;
      display: none;
    }
    
    .admin-btn:hover {
      transform: scale(1.1);
    }
    
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.8);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1rem;
      cursor: pointer;
      z-index: 100;
    }
    
    /* 灯箱样式 */
    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .lightbox img {
      max-width: 80%;
      max-height: 80%;
      border-radius: 5px;
    }
    
    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      font-size: 2rem;
      cursor: pointer;
    }
    
    /* 编辑模式样式 */
    .edit-mode .gallery-item::after {
      content: '';
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      cursor: pointer;
    }
    
    .edit-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      padding: 15px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      transform: translateY(100%);
      transition: transform 0.3s;
      z-index: 100;
    }
    
    .edit-panel.active {
      transform: translateY(0);
    }
    
    @media (max-width: 768px) {
      .gallery-container {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Sakino's Gallery</h1>
    <p>Welcome to my visual collection</p>
  </header>
  
  <button class="back-btn" onclick="window.history.back()">←</button>
  
  <div class="gallery-container" id="gallery">
    <!-- 图片将通过JavaScript动态加载 -->
  </div>
  
  <div class="admin-controls">
    <button class="admin-btn" id="editBtn">✏️</button>
    <button class="admin-btn" id="addBtn">➕</button>
  </div>
  
  <div class="lightbox" id="lightbox">
    <span class="lightbox-close" onclick="closeLightbox()">×</span>
    <img id="lightbox-img" src="" alt="Enlarged view">
  </div>
  
  <div class="edit-panel" id="editPanel">
    <h3>Edit Image</h3>
    <input type="text" id="imageTitle" placeholder="Image title">
    <textarea id="imageDesc" placeholder="Image description"></textarea>
    <div>
      <button onclick="saveChanges()">Save</button>
      <button onclick="cancelEdit()">Cancel</button>
      <button onclick="deleteImage()" class="delete-btn">Delete</button>
    </div>
  </div>

  <script>
    // 示例图片数据
    const galleryData = [
      { id: 1, src: "images/gallery1.jpg", title: "Spring Morning", desc: "A peaceful morning in early spring" },
      { id: 2, src: "images/gallery2.jpg", title: "Mountain View", desc: "Beautiful mountain landscape" },
      { id: 3, src: "images/gallery3.jpg", title: "Ocean Sunset", desc: "Sunset over the pacific ocean" },
      { id: 4, src: "images/gallery4.jpg", title: "Forest Path", desc: "A path through the ancient forest" },
      { id: 5, src: "images/gallery5.jpg", title: "City Lights", desc: "Night view of the city" },
      { id: 6, src: "images/gallery6.jpg", title: "Autumn Leaves", desc: "Colorful autumn foliage" }
    ];

    // 初始化画廊
    function initGallery() {
      const gallery = document.getElementById('gallery');
      
      galleryData.forEach(item => {
        const galleryItem = document.createElement('div');
        galleryItem.className = 'gallery-item';
        galleryItem.dataset.id = item.id;
        
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = item.title;
        img.loading = "lazy";
        
        img.addEventListener('click', () => {
          openLightbox(item.src);
        });
        
        galleryItem.appendChild(img);
        gallery.appendChild(galleryItem);
      });
    }

    // 灯箱功能
    function openLightbox(src) {
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightbox-img');
      
      lightboxImg.src = src;
      lightbox.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      const lightbox = document.getElementById('lightbox');
      lightbox.style.display = 'none';
      document.body.style.overflow = '';
    }

    // 管理功能
    function checkAuth() {
      const auth = JSON.parse(localStorage.getItem('gallery_auth'));
      const isAuthenticated = auth && auth.authenticated && auth.expires > Date.now();
      
      if (isAuthenticated) {
        document.querySelectorAll('.admin-btn').forEach(btn => {
          btn.style.display = 'block';
        });
      }
    }

    // 进入编辑模式
    function enterEditMode() {
      document.body.classList.add('edit-mode');
      document.getElementById('editPanel').classList.add('active');
      
      // 添加编辑按钮到每个图片
      document.querySelectorAll('.gallery-item').forEach(item => {
        item.addEventListener('click', function(e) {
          if (e.target === this || e.target === this.querySelector('img')) {
            const itemId = this.dataset.id;
            const selectedItem = galleryData.find(item => item.id == itemId);
            
            if (selectedItem) {
              document.getElementById('imageTitle').value = selectedItem.title;
              document.getElementById('imageDesc').value = selectedItem.desc;
              document.getElementById('editPanel').dataset.editingId = itemId;
            }
          }
        });
      });
    }

    // 保存更改
    function saveChanges() {
      const itemId = document.getElementById('editPanel').dataset.editingId;
      const title = document.getElementById('imageTitle').value;
      const desc = document.getElementById('imageDesc').value;
      
      // 这里应该发送到服务器保存
      console.log(`Saving changes for item ${itemId}:`, { title, desc });
      
      exitEditMode();
    }

    // 删除图片
    function deleteImage() {
      const itemId = document.getElementById('editPanel').dataset.editingId;
      
      if (confirm('Are you sure you want to delete this image?')) {
        // 这里应该发送到服务器删除
        console.log(`Deleting item ${itemId}`);
        
        const itemElement = document.querySelector(`.gallery-item[data-id="${itemId}"]`);
        if (itemElement) {
          itemElement.remove();
        }
        
        exitEditMode();
      }
    }

    // 退出编辑模式
    function exitEditMode() {
      document.body.classList.remove('edit-mode');
      document.getElementById('editPanel').classList.remove('active');
      document.getElementById('editPanel').dataset.editingId = '';
    }

    // 取消编辑
    function cancelEdit() {
      exitEditMode();
    }

    // 添加新图片
    function addNewImage() {
      // 这里应该是打开文件选择器上传新图片
      alert('Upload new image functionality would go here');
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      initGallery();
      checkAuth();
      
      // 绑定管理按钮事件
      document.getElementById('editBtn').addEventListener('click', enterEditMode);
      document.getElementById('addBtn').addEventListener('click', addNewImage);
      
      // 从主页获取主题设置
      if (window.opener && opener.appController) {
        if (opener.appController.theme === 'dark') {
          document.body.classList.add('dark');
        }
      }
    });

    // 全局访问函数
    window.requestEditAccess = function() {
      if (window.opener && opener.appController) {
        opener.appController.launchGalleryWindow(true);
      } else {
        const password = prompt("请输入编辑密码:");
        if (password === "010101") {
          localStorage.setItem('gallery_auth', JSON.stringify({
            authenticated: true,
            expires: Date.now() + 3600000
          }));
          checkAuth();
          return true;
        }
        alert("密码错误");
        return false;
      }
    };
  </script>
</body>
</html>
